<!-- poll_list.html -->
{% extends 'polls/layout.html' %}
{% load pluralize %}

{% block styles %}
    <style>
        .poll-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .poll-card:hover {
            transform: scale(1.01);
        }

        .poll-card-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .poll-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        a.btn.disabled {
            cursor: not-allowed;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container mt-4">
        <h2>–°–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</h2>

        {% if request.user.is_superuser %}
            <a class="btn btn-secondary mb-3" href="{% url "poll_add" %}">–°–æ–∑–¥–∞—Ç—å</a>
        {% endif %}

        {% for poll in polls %}
            <div class="poll-card">
                <div class="poll-card-title">{{ poll.title }}</div>
                <div class="text-muted small mb-2">üéÆ {{ poll.games.count | ru_plural:"–∏–≥—Ä–∞,–∏–≥—Ä—ã,–∏–≥—Ä" }} {% if request.user.is_superuser %} &bull; üó≥ {{ poll.vote_set.count | ru_plural:"–≥–æ–ª–æ—Å,–≥–æ–ª–æ—Å–∞,–≥–æ–ª–æ—Å–æ–≤" }} {% endif %}</div>

                <div class="poll-actions">
                    <a href="{% url "vote_add" poll.id %}" class="btn btn-primary btn-sm {% if poll.status != "active" %}disabled{% endif %}" {% if poll.status != "active" %}aria-disabled="true"{% endif %}>üó≥ –ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</a>
                    <a href="{% url "poll_stats" poll.id %}" class="btn btn-outline-secondary btn-sm {% if poll.status != "finished" %}disabled{% endif %}" {% if poll.status != "finished" %}aria-disabled="true"{% endif %}>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
                    {% if request.user.is_superuser %}
                    <a href="{% url "poll_details" poll.id %}" class="btn btn-outline-secondary btn-sm">üìë –ì–æ–ª–æ—Å–∞</a>
                {% endif %}</div>

                {% if request.user.is_superuser %}
                    <div class="btn-group text-end mt-4" role="group">
                        <a href="{% url 'poll_toggle_lock' poll.id 'active' %}"
                           class="btn {% if poll.status == 'active' %}btn-outline-primary border-3{% else %}btn-outline-secondary{% endif %}"
                           {% if poll.status == 'active' %}disabled{% endif %}>
                            –ê–∫—Ç–∏–≤–Ω–æ
                        </a>

                        <a href="{% url 'poll_toggle_lock' poll.id 'closed' %}"
                           class="btn {% if poll.status == 'closed' %}btn-outline-warning border-3{% else %}btn-outline-secondary{% endif %}"
                           {% if poll.status == 'closed' %}disabled{% endif %}>
                            –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                        </a>

                        <a href="{% url 'poll_toggle_lock' poll.id 'finished' %}"
                           class="btn {% if poll.status == 'finished' %}btn-outline-success border-3{% else %}btn-outline-secondary{% endif %}"
                           {% if poll.status == 'finished' %}disabled{% endif %}>
                            –ò—Ç–æ–≥–∏ –ø–æ–¥–≤–µ–¥–µ–Ω—ã
                        </a>
                    </div>
                {% endif %}
            </div>
        {% empty %}
            <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</p>
        {% endfor %}

        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% for page_num in polls.paginator.page_range %}
                    <li class="page-item{% if page_num == polls.number %} active{% endif %}">
                        <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                    </li>
                {% endfor %}
            </ul>
        </nav>
    </div>
{% endblock %}
