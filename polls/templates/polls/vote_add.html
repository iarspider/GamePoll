{% extends "polls/layout.html" %}
{% load static %}

{% block scripts %}
  <script src="{% static "polls/addvote.js" %}"></script>
{% endblock %}

{% block styles %}
<style>
  .game-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s;
  }
  .game-card.excluded {
    filter: grayscale(100%);
  }
  .game-card:hover {
    transform: scale(1.01);
  }
  .game-card img {
    border-radius: 6px;
    max-width: 180px;
  }
  .handle {
    cursor: grab;
    font-size: 1.4rem;
    padding-right: 0.5rem;
  }
  .vote-options {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 1rem;
    font-size: 1.8rem;
  }
  .vote-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1.5rem;
  }
</style>
{% endblock %}

{% block content %}
  <form id="voteForm" method="post" action="{% url 'vote_add' poll_id=poll.id %}">
    {% csrf_token %}

    <div class="container">
      <h1 class="mb-3">{{ poll.title }}</h1>
      <p class="text-muted">
        –£–ø–æ—Ä—è–¥–æ—á–∏—Ç–µ –∏–≥—Ä—ã –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º –∑–∞ <i class="bi bi-list"></i>. –ß–µ–º –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ –∏–≥—Ä–∞, —Ç–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ –≤–∞–º –µ—ë —É–≤–∏–¥–µ—Ç—å.
        –£–±–µ—Ä–∏—Ç–µ –≥–∞–ª–æ—á–∫—É —É —Ç–µ—Ö –∏–≥—Ä, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º —Å–æ–≤—Å–µ–º –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã.
      </p>
      {% if is_sub %}
      <p class="text-muted">–í—ã –º–æ–∂–µ—Ç–µ —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å –≥–æ–ª–æ—Å–∞ –∑–∞ –æ–¥–Ω—É –∏–∑ –∏–≥—Ä, –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–≤ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ‚≠ê —Ä—è–¥–æ–º —Å –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ–º.</p>
      {% endif %}
      <p class="text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ü¶â, üßÄ –∏–ª–∏ üêù, –µ—Å–ª–∏ –≤–∞–º –≤—Å—ë —Ä–∞–≤–Ω–æ, —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å.</p>

      <div id="sortable-list" class="mt-4">
        {% for game in poll.games.all %}
        <div class="card mb-3 game-card" data-game-id="{{ game.id }}">
          <div class="row g-0 align-items-center">
            <div class="col-md-1 d-flex justify-content-center">
              <i class="bi bi-list handle"></i>
            </div>
            <div class="col-md-2 d-none d-md-flex justify-content-center">
              <img src="{{ game.logo_url }}" alt="{{ game.name }}" class="img-fluid">
            </div>
            <div class="col-md-9">
              <div class="card-body">
                <h5 class="card-title mb-1">
                  <input type="checkbox" name="game_{{ game.id }}" checked>
                  {% if is_sub %}
                    <input type="radio" class="star" name="premium" id="premium{{ game.id }}">
                    <label for="premium{{ game.id }}"><i class="bi bi-star"></i></label>
                  {% endif %}
                  <a href="{{ game.alt_url }}" target="_blank">{{ game.name }}</a>
                </h5>
                <p class="card-text text-muted small mb-1">{{ game.description }}</p>
                <p class="card-text small">
                  {% for tag in game.tags.all %}
                    <span class="badge bg-secondary">{{ tag.name }}</span>
                  {% empty %}
                    <span class="text-muted">No tags</span>
                  {% endfor %}
                </p>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      {% if is_sub %}
      <div class="mt-2">
        <input type="radio" class="blackstar" name="premium" id="premiumNone" checked>
        <label for="premiumNone"><i class="bi bi-star-fill"></i></label> –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å
      </div>
      {% endif %}

      <div class="vote-options">
        <label><input type="checkbox" name="owl_checkbox" class="form-check-input"> ü¶â</label>
        <label><input type="checkbox" name="cheese_checkbox" class="form-check-input"> üßÄ</label>
        <label><input type="checkbox" name="bee_checkbox" class="form-check-input"> üêù</label>
      </div>

      <div class="vote-buttons">
        <button type="button" class="btn btn-warning" id="shuffleButton">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
        <button type="submit" class="btn btn-primary">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
        <button type="button" class="btn btn-secondary" onclick="location.href='{% url 'poll_list' %}'">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", init_addvote);
  </script>
{% endblock %}
