{% extends 'polls/layout.html' %}
{% load static %}

{% block scripts %}
<script src="{% static 'polls/newpoll.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  init_new_poll();

  // Фильтр по названию
  const searchInput = document.getElementById("gameSearch");
  searchInput.addEventListener("input", () => {
    const filter = searchInput.value.toLowerCase();
    document.querySelectorAll("#allGamesList li").forEach(li => {
      const name = li.querySelector("span").textContent.toLowerCase();
      li.style.display = name.includes(filter) ? "" : "none";
    });
  });
});
</script>
{% endblock %}

{% block styles %}
<style>
  .games-panel {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 1rem;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    height: 900px;
  }
  .games-panel h4 {
    margin-bottom: 0.5rem;
    text-align: center;
  }
  .games-panel .list-group {
    flex: 1;
    overflow-y: auto;
    margin-top: 0.5rem;
  }
  .list-group-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }
  .list-group-item img {
    max-width: 60px;
    border-radius: 4px;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Создать новое голосование</h2>

  <form action="{% url 'poll_add' %}" method="post" id="createPollForm">
    {% csrf_token %}

    <div class="mb-3">
      <label for="title" class="form-label fw-bold">Название голосования</label>
      <input type="text" id="title" name="title" maxlength="255" class="form-control" required>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="games-panel">
          <h4>Доступные игры</h4>
          <input type="text" id="gameSearch" placeholder="Поиск..." class="form-control mb-2">
          <ul id="allGamesList" class="list-group">
            {% for game in games %}
            <li class="list-group-item" data-game-id="{{ game.id }}">
              <img src="{{ game.small_logo_url }}" alt="{{ game.name }}">
              <span>{{ game.name }}</span>
              <button type="button" class="btn btn-outline-primary btn-sm move-btn">Добавить</button>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div class="col-md-6">
        <div class="games-panel">
          <h4>Выбранные игры</h4>
          <ul id="selectedGamesList" class="list-group connectedSortable"></ul>
        </div>
      </div>
    </div>

    <input type="hidden" name="selectedIds" aria-hidden="true"/>
<!--
    <div class="mt-3">
      <label for="start_date" class="form-label fw-bold">Дата начала</label>
      <input type="datetime-local" class="form-control" id="start_date" name="start_date" required disabled>
    </div>

    <div class="mt-3">
      <label for="end_date" class="form-label fw-bold">Дата окончания</label>
      <input type="datetime-local" class="form-control" id="end_date" name="end_date" required disabled>
    </div>

    <div class="form-check mt-3">
      <input type="checkbox" class="form-check-input" id="anonymous" name="anonymous" disabled>
      <label class="form-check-label" for="anonymous">Анонимное голосование</label>
    </div>
-->
    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="submit" class="btn btn-primary">Создать</button>
      <button type="button" class="btn btn-warning" id="resetBtn">Сбросить</button>
      <a href="{% url 'poll_list' %}" class="btn btn-secondary">Отмена</a>
    </div>
  </form>
</div>
{% endblock %}
